<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>线程堆栈分析 | klion26</title>
  <meta name="author" content="klion26">
  
  <meta name="description" content="个人博客，记录自己成长的点点滴滴">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="线程堆栈分析"/>
  <meta property="og:site_name" content="klion26"/>

  
    <meta property="og:image" content="undefined"/>
  

  
    <link rel="alternative" href="/atom.xml" title="klion26" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/css/themes/bootstrap.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">klion26</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/resume" title="Resume">
			  <i class=""></i>Resume
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header page-header-inverse ">		
			<h1 class="title title-inverse "> 线程堆栈分析</h1>
		</div>		
	






<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p>本文为读书笔记，关于 Java 线程堆栈分析，在阅读并进行实验的基础上进行整理，如果有问题欢迎反馈<br><a id="more"></a></p>
<p>Java 虚拟机提供了线程转储（Thread dump）的后门，通过这个后门，可以将线程堆栈打印出来。这个后门就是通过向 Java 进程发送一个 QUIT 信号，Java 虚拟机收到该信号之后，将系统当前的 Java 线程调用堆栈打印出来。</p>
<p><code>kill -3 &lt;java_pid&gt;  /jstack &lt;java_pid&gt;</code></p>
<h1 id="1-Demo"><a href="#1-Demo" class="headerlink" title="1. Demo"></a>1. Demo</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">public class MyTest &#123;</div><div class="line">	    Object obj1 = new Object();</div><div class="line">		Object obj2 = new Object();</div><div class="line">		public void fun1() &#123;</div><div class="line">			synchronized(obj1) &#123;</div><div class="line">				fun2();</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		public void fun2() &#123;</div><div class="line">			synchronized(obj2) &#123;</div><div class="line">				while(true) &#123;</div><div class="line">					System.out.print(&quot;&quot;);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		public static void main(String[] args) &#123;</div><div class="line">			MyTest aa = new MyTest();</div><div class="line">			aa.fun1();</div><div class="line">		&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="1-1-使用-kill-3-得到的结果"><a href="#1-1-使用-kill-3-得到的结果" class="headerlink" title="1.1 使用 kill -3 得到的结果"></a>1.1 使用 kill -3 得到的结果</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">2017-12-26 10:59:58</div><div class="line">Full thread dump Java HotSpot(TM) 64-Bit Server VM (24.76-b04 mixed mode):</div><div class="line">	&quot;Attach Listener&quot; daemon prio=10 tid=0x00007fd9d4001000 nid=0x6993 runnable [0x0000000000000000]</div><div class="line">		java.lang.Thread.State: RUNNABLE</div><div class="line">	&quot;Service Thread&quot; daemon prio=10 tid=0x00007fda3c0a8800 nid=0x695f runnable [0x0000000000000000]</div><div class="line">		java.lang.Thread.State: RUNNABLE</div><div class="line">	&quot;C2 CompilerThread1&quot; daemon prio=10 tid=0x00007fda3c0a6000 nid=0x695e waiting on condition [0x0000000000000000]</div><div class="line">		java.lang.Thread.State: RUNNABLE</div><div class="line">	&quot;C2 CompilerThread0&quot; daemon prio=10 tid=0x00007fda3c0a3000 nid=0x695d waiting on condition [0x0000000000000000]</div><div class="line">		java.lang.Thread.State: RUNNABLE</div><div class="line">	&quot;Signal Dispatcher&quot; daemon prio=10 tid=0x00007fda3c0a0800 nid=0x695c waiting on condition [0x0000000000000000]</div><div class="line">		java.lang.Thread.State: RUNNABLE</div><div class="line">	&quot;Finalizer&quot; daemon prio=10 tid=0x00007fda3c078000 nid=0x695b in Object.wait() [0x00007fda32e06000]</div><div class="line">		java.lang.Thread.State: WAITING (on object monitor)</div><div class="line">		at java.lang.Object.wait(Native Method)</div><div class="line">		- waiting on &lt;0x0000000758c04858&gt; (a java.lang.ref.ReferenceQueue$Lock)</div><div class="line">		at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:135)</div><div class="line">		- locked &lt;0x0000000758c04858&gt; (a java.lang.ref.ReferenceQueue$Lock)</div><div class="line">		at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:151)</div><div class="line">		at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)</div><div class="line">	&quot;Reference Handler&quot; daemon prio=10 tid=0x00007fda3c076000 nid=0x695a in Object.wait() [0x00007fd9ec28e000]</div><div class="line">		java.lang.Thread.State: WAITING (on object monitor)</div><div class="line">		at java.lang.Object.wait(Native Method)</div><div class="line">		- waiting on &lt;0x0000000758c04470&gt; (a java.lang.ref.Reference$Lock)</div><div class="line">		at java.lang.Object.wait(Object.java:503)</div><div class="line">		at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:133)</div><div class="line">		- locked &lt;0x0000000758c04470&gt; (a java.lang.ref.Reference$Lock)</div><div class="line">		&quot;main&quot; prio=10 tid=0x00007fda3c008800 nid=0x6950 runnable [0x00007fda4588a000]</div><div class="line">		java.lang.Thread.State: RUNNABLE</div><div class="line">		at MyTest.fun2(MyTest.java:12)</div><div class="line">		- locked &lt;0x0000000758c4a7f8&gt; (a java.lang.Object)</div><div class="line">		at MyTest.fun1(MyTest.java:6)</div><div class="line">		- locked &lt;0x0000000758c4a7e8&gt; (a java.lang.Object)</div><div class="line">		at MyTest.main(MyTest.java:18)</div><div class="line">	&quot;VM Thread&quot; prio=10 tid=0x00007fda3c071800 nid=0x6959 runnable</div><div class="line">	&quot;GC task thread#0 (ParallelGC)&quot; prio=10 tid=0x00007fda3c01e000 nid=0x6951 runnable</div><div class="line">	&quot;GC task thread#1 (ParallelGC)&quot; prio=10 tid=0x00007fda3c020000 nid=0x6952 runnable</div><div class="line">	&quot;GC task thread#2 (ParallelGC)&quot; prio=10 tid=0x00007fda3c022000 nid=0x6953 runnable</div><div class="line">	&quot;GC task thread#3 (ParallelGC)&quot; prio=10 tid=0x00007fda3c024000 nid=0x6954 runnable</div><div class="line">	&quot;GC task thread#4 (ParallelGC)&quot; prio=10 tid=0x00007fda3c026000 nid=0x6955 runnable</div><div class="line">	&quot;GC task thread#5 (ParallelGC)&quot; prio=10 tid=0x00007fda3c027800 nid=0x6956 runnable</div><div class="line">	&quot;GC task thread#6 (ParallelGC)&quot; prio=10 tid=0x00007fda3c029800 nid=0x6957 runnable</div><div class="line">	&quot;GC task thread#7 (ParallelGC)&quot; prio=10 tid=0x00007fda3c02b800 nid=0x6958 runnable</div><div class="line">	&quot;VM Periodic Task Thread&quot; prio=10 tid=0x00007fda3c0b3000 nid=0x6960 waiting on condition</div><div class="line">	JNI global references: 123</div><div class="line">	Heap</div><div class="line">		PSYoungGen total 150528K, used 7772K [0x0000000758c00000, 0x0000000763380000, 0x0000000800000000)</div><div class="line">		eden space 129536K, 6% used [0x0000000758c00000,0x0000000759397200,0x0000000760a80000)</div><div class="line">		from space 20992K, 0% used [0x0000000761f00000,0x0000000761f00000,0x0000000763380000)</div><div class="line">		to space 20992K, 0% used [0x0000000760a80000,0x0000000760a80000,0x0000000761f00000)</div><div class="line">		ParOldGen total 342528K, used 0K [0x000000060a400000, 0x000000061f280000, 0x0000000758c00000)</div><div class="line">		object space 342528K, 0% used [0x000000060a400000,0x000000060a400000,0x000000061f280000)</div><div class="line">		PSPermGen total 21504K, used 2429K [0x0000000605200000, 0x0000000606700000, 0x000000060a400000)</div><div class="line">		object space 21504K, 11% used [0x0000000605200000,0x000000060545f738,0x0000000606700000)</div></pre></td></tr></table></figure>
<h2 id="1-2-jstack-的结果"><a href="#1-2-jstack-的结果" class="headerlink" title="1.2 jstack 的结果"></a>1.2 jstack 的结果</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">2017-12-26 11:04:54</div><div class="line">Full thread dump Java HotSpot(TM) 64-Bit Server VM (24.76-b04 mixed mode):</div><div class="line">	&quot;Attach Listener&quot; daemon prio=10 tid=0x00007fd9d4001000 nid=0x6993 waiting on condition [0x0000000000000000]</div><div class="line">		java.lang.Thread.State: RUNNABLE</div><div class="line">	&quot;Service Thread&quot; daemon prio=10 tid=0x00007fda3c0a8800 nid=0x695f runnable [0x0000000000000000]</div><div class="line">		java.lang.Thread.State: RUNNABLE</div><div class="line">	&quot;C2 CompilerThread1&quot; daemon prio=10 tid=0x00007fda3c0a6000 nid=0x695e waiting on condition [0x0000000000000000]</div><div class="line">		java.lang.Thread.State: RUNNABLE</div><div class="line">	&quot;C2 CompilerThread0&quot; daemon prio=10 tid=0x00007fda3c0a3000 nid=0x695d waiting on condition [0x0000000000000000]</div><div class="line">		java.lang.Thread.State: RUNNABLE</div><div class="line">	&quot;Signal Dispatcher&quot; daemon prio=10 tid=0x00007fda3c0a0800 nid=0x695c runnable [0x0000000000000000]</div><div class="line">		java.lang.Thread.State: RUNNABLE</div><div class="line">	&quot;Finalizer&quot; daemon prio=10 tid=0x00007fda3c078000 nid=0x695b in Object.wait() [0x00007fda32e06000]</div><div class="line">		java.lang.Thread.State: WAITING (on object monitor)</div><div class="line">		at java.lang.Object.wait(Native Method)</div><div class="line">		- waiting on &lt;0x0000000758c04858&gt; (a java.lang.ref.ReferenceQueue$Lock)</div><div class="line">		at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:135)</div><div class="line">		- locked &lt;0x0000000758c04858&gt; (a java.lang.ref.ReferenceQueue$Lock)</div><div class="line">		at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:151)</div><div class="line">		at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)</div><div class="line">	&quot;Reference Handler&quot; daemon prio=10 tid=0x00007fda3c076000 nid=0x695a in Object.wait() [0x00007fd9ec28e000]</div><div class="line">		java.lang.Thread.State: WAITING (on object monitor)</div><div class="line">		at java.lang.Object.wait(Native Method)</div><div class="line">		- waiting on &lt;0x0000000758c04470&gt; (a java.lang.ref.Reference$Lock)</div><div class="line">		at java.lang.Object.wait(Object.java:503)</div><div class="line">		at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:133)</div><div class="line">		- locked &lt;0x0000000758c04470&gt; (a java.lang.ref.Reference$Lock)</div><div class="line">	&quot;main&quot; prio=10 tid=0x00007fda3c008800 nid=0x6950 runnable [0x00007fda4588a000]</div><div class="line">		java.lang.Thread.State: RUNNABLE</div><div class="line">		at MyTest.fun2(MyTest.java:12)</div><div class="line">		- locked &lt;0x0000000758c4a7f8&gt; (a java.lang.Object)</div><div class="line">		at MyTest.fun1(MyTest.java:6)</div><div class="line">		- locked &lt;0x0000000758c4a7e8&gt; (a java.lang.Object)</div><div class="line">		at MyTest.main(MyTest.java:18)</div><div class="line">	&quot;VM Thread&quot; prio=10 tid=0x00007fda3c071800 nid=0x6959 runnable</div><div class="line">	&quot;GC task thread#0 (ParallelGC)&quot; prio=10 tid=0x00007fda3c01e000 nid=0x6951 runnable</div><div class="line">	&quot;GC task thread#1 (ParallelGC)&quot; prio=10 tid=0x00007fda3c020000 nid=0x6952 runnable</div><div class="line">	&quot;GC task thread#2 (ParallelGC)&quot; prio=10 tid=0x00007fda3c022000 nid=0x6953 runnable</div><div class="line">	&quot;GC task thread#3 (ParallelGC)&quot; prio=10 tid=0x00007fda3c024000 nid=0x6954 runnable</div><div class="line">	&quot;GC task thread#4 (ParallelGC)&quot; prio=10 tid=0x00007fda3c026000 nid=0x6955 runnable</div><div class="line">	&quot;GC task thread#5 (ParallelGC)&quot; prio=10 tid=0x00007fda3c027800 nid=0x6956 runnable</div><div class="line">	&quot;GC task thread#6 (ParallelGC)&quot; prio=10 tid=0x00007fda3c029800 nid=0x6957 runnable</div><div class="line">	&quot;GC task thread#7 (ParallelGC)&quot; prio=10 tid=0x00007fda3c02b800 nid=0x6958 runnable</div><div class="line">	&quot;VM Periodic Task Thread&quot; prio=10 tid=0x00007fda3c0b3000 nid=0x6960 waiting on condition</div><div class="line">	JNI global references: 123</div></pre></td></tr></table></figure>
<h2 id="1-3-分析"><a href="#1-3-分析" class="headerlink" title="1.3 分析"></a>1.3 分析</h2><p>用户线程为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&quot;main&quot; prio=10 tid=0x00007fda3c008800 nid=0x6950 runnable [0x00007fda4588a000] //main 表示线程名称，proi=1 表示线程优先级，tid=0x00007fda3c008800 表示线程 id，nid=0x6950 表示本地线程 id（这个查问题的时候会用到），runnable 表示线程状态，0x00007fda4588a000 表示内存地址</div><div class="line"> java.lang.Thread.State: RUNNABLE</div><div class="line">  at MyTest.fun2(MyTest.java:12) //第一个MyTest 表示类名，fun2 表示方法名，第二个 MyTest.java 表示正在调用的函数所在的源代码文件，12 表示行号</div><div class="line">	 - locked &lt;0x0000000758c4a7f8&gt; (a java.lang.Object) //locked 表示持有锁，后面的 0x0000000758c4a7f8 表示锁的 ID</div><div class="line">	 at MyTest.fun1(MyTest.java:6)</div><div class="line">	 - locked &lt;0x0000000758c4a7e8&gt; (a java.lang.Object)</div><div class="line">	 at MyTest.main(MyTest.java:18)</div></pre></td></tr></table></figure>
<p>如何获得 Java 虚拟机对应的本地线程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">1. jps //获取 Java 进程 ID</div><div class="line">2. pstack &lt;java_pid&gt; 获得 Java 虚拟机的本地线程的堆栈</div></pre></td></tr></table></figure>
<p>获得的本地线程栈如下所示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div></pre></td><td class="code"><pre><div class="line">Thread 19 (Thread 0x7fda4588b700 (LWP 26960)): // Thread 19 表示线程名称，0x7fda4588b700 表示本地线程 id，LWP 26960 本地线程的另一种表示，LWP-light weight process（和上面的 nid 会一一对应，这里是十进制，上面的是十六进制）</div><div class="line">#0 0x00007fda401b2c47 in ?? ()</div><div class="line">#1 0x00007fda401ab8fc in ?? ()</div><div class="line">#2 0x0000000758c4a7f8 in ?? ()</div><div class="line">#3 0x00007fda4588a8a0 in ?? ()</div><div class="line">#4 0x0000000000000001 in ?? ()</div><div class="line">#5 0x00007fda4014f058 in ?? ()</div><div class="line">#6 0x00007fda4588a8f8 in ?? ()</div><div class="line">#7 0x00007fda4014f058 in ?? ()</div><div class="line">#8 0x0000000758c4a7d0 in ?? ()</div><div class="line">#9 0x0000000000000001 in ?? ()</div><div class="line">#10 0x0000000758c4a7e8 in ?? ()</div><div class="line">#11 0x00007fda4588a8a8 in ?? ()</div><div class="line">#12 0x000000060545d7b0 in ?? ()</div><div class="line">#13 0x00007fda4588a918 in ?? ()</div><div class="line">#14 0x000000060545dc80 in ?? ()</div><div class="line">#15 0x0000000000000000 in ?? ()</div><div class="line">	Thread 18 (Thread 0x7fda40148700 (LWP 26961)):</div><div class="line">#0 0x00007fda4546b68c in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda44652543 in os::PlatformEvent::park() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#2 0x00007fda4461987f in Monitor::IWait(Thread*, long) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#3 0x00007fda4461a00e in Monitor::wait(bool, long, bool) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#4 0x00007fda4438dad3 in GCTaskManager::get_task(unsigned int) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#5 0x00007fda4438f198 in GCTaskThread::run() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#6 0x00007fda44658ca8 in java_start(Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#7 0x00007fda45467aa1 in start_thread () from /lib64/libpthread.so.0</div><div class="line">#8 0x00007fda44d99aad in clone () from /lib64/libc.so.6</div><div class="line">		Thread 17 (Thread 0x7fda3a5b3700 (LWP 26962)):</div><div class="line">#0 0x00007fda4546b68c in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda44652543 in os::PlatformEvent::park() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#2 0x00007fda4461987f in Monitor::IWait(Thread*, long) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#3 0x00007fda4461a00e in Monitor::wait(bool, long, bool) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#4 0x00007fda4438dad3 in GCTaskManager::get_task(unsigned int) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#5 0x00007fda4438f198 in GCTaskThread::run() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#6 0x00007fda44658ca8 in java_start(Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#7 0x00007fda45467aa1 in start_thread () from /lib64/libpthread.so.0</div><div class="line">#8 0x00007fda44d99aad in clone () from /lib64/libc.so.6</div><div class="line">			Thread 16 (Thread 0x7fda3a4b2700 (LWP 26963)):</div><div class="line">#0 0x00007fda4546b68c in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda44652543 in os::PlatformEvent::park() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#2 0x00007fda4461987f in Monitor::IWait(Thread*, long) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#3 0x00007fda4461a00e in Monitor::wait(bool, long, bool) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#4 0x00007fda4438dad3 in GCTaskManager::get_task(unsigned int) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#5 0x00007fda4438f198 in GCTaskThread::run() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#6 0x00007fda44658ca8 in java_start(Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#7 0x00007fda45467aa1 in start_thread () from /lib64/libpthread.so.0</div><div class="line">#8 0x00007fda44d99aad in clone () from /lib64/libc.so.6</div><div class="line">				Thread 15 (Thread 0x7fda3a3b1700 (LWP 26964)):</div><div class="line">#0 0x00007fda4546b68c in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda44652543 in os::PlatformEvent::park() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#2 0x00007fda4461987f in Monitor::IWait(Thread*, long) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#3 0x00007fda4461a00e in Monitor::wait(bool, long, bool) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#4 0x00007fda4438dad3 in GCTaskManager::get_task(unsigned int) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#5 0x00007fda4438f198 in GCTaskThread::run() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#6 0x00007fda44658ca8 in java_start(Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#7 0x00007fda45467aa1 in start_thread () from /lib64/libpthread.so.0</div><div class="line">#8 0x00007fda44d99aad in clone () from /lib64/libc.so.6</div><div class="line">					Thread 14 (Thread 0x7fda3a2b0700 (LWP 26965)):</div><div class="line">#0 0x00007fda4546b68c in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda44652543 in os::PlatformEvent::park() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#2 0x00007fda4461987f in Monitor::IWait(Thread*, long) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#3 0x00007fda4461a00e in Monitor::wait(bool, long, bool) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#4 0x00007fda4438dad3 in GCTaskManager::get_task(unsigned int) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#5 0x00007fda4438f198 in GCTaskThread::run() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#6 0x00007fda44658ca8 in java_start(Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#7 0x00007fda45467aa1 in start_thread () from /lib64/libpthread.so.0</div><div class="line">#8 0x00007fda44d99aad in clone () from /lib64/libc.so.6</div><div class="line">						Thread 13 (Thread 0x7fda3a1af700 (LWP 26966)):</div><div class="line">#0 0x00007fda4546b68c in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda44652543 in os::PlatformEvent::park() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#2 0x00007fda4461987f in Monitor::IWait(Thread*, long) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#3 0x00007fda4461a00e in Monitor::wait(bool, long, bool) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#4 0x00007fda4438dad3 in GCTaskManager::get_task(unsigned int) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#5 0x00007fda4438f198 in GCTaskThread::run() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#6 0x00007fda44658ca8 in java_start(Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#7 0x00007fda45467aa1 in start_thread () from /lib64/libpthread.so.0</div><div class="line">#8 0x00007fda44d99aad in clone () from /lib64/libc.so.6</div><div class="line">							Thread 12 (Thread 0x7fda3a0ae700 (LWP 26967)):</div><div class="line">#0 0x00007fda4546b68c in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda44652543 in os::PlatformEvent::park() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#2 0x00007fda4461987f in Monitor::IWait(Thread*, long) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#3 0x00007fda4461a00e in Monitor::wait(bool, long, bool) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#4 0x00007fda4438dad3 in GCTaskManager::get_task(unsigned int) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#5 0x00007fda4438f198 in GCTaskThread::run() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#6 0x00007fda44658ca8 in java_start(Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#7 0x00007fda45467aa1 in start_thread () from /lib64/libpthread.so.0</div><div class="line">#8 0x00007fda44d99aad in clone () from /lib64/libc.so.6</div><div class="line">								Thread 11 (Thread 0x7fda39fad700 (LWP 26968)):</div><div class="line">#0 0x00007fda4546b68c in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda44652543 in os::PlatformEvent::park() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#2 0x00007fda4461987f in Monitor::IWait(Thread*, long) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#3 0x00007fda4461a00e in Monitor::wait(bool, long, bool) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#4 0x00007fda4438dad3 in GCTaskManager::get_task(unsigned int) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#5 0x00007fda4438f198 in GCTaskThread::run() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#6 0x00007fda44658ca8 in java_start(Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#7 0x00007fda45467aa1 in start_thread () from /lib64/libpthread.so.0</div><div class="line">#8 0x00007fda44d99aad in clone () from /lib64/libc.so.6</div><div class="line">									Thread 10 (Thread 0x7fda32f08700 (LWP 26969)):</div><div class="line">#0 0x00007fda4546ba5e in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda44657c0f in os::PlatformEvent::park(long) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#2 0x00007fda44619b2e in Monitor::IWait(Thread*, long) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#3 0x00007fda4461a00e in Monitor::wait(bool, long, bool) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#4 0x00007fda447e1899 in VMThread::loop() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#5 0x00007fda447e1ba0 in VMThread::run() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#6 0x00007fda44658ca8 in java_start(Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#7 0x00007fda45467aa1 in start_thread () from /lib64/libpthread.so.0</div><div class="line">#8 0x00007fda44d99aad in clone () from /lib64/libc.so.6</div><div class="line">										Thread 9 (Thread 0x7fd9ec28f700 (LWP 26970)):</div><div class="line">#0 0x00007fda4546b68c in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda44652543 in os::PlatformEvent::park() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#2 0x00007fda44646ddd in ObjectMonitor::wait(long, bool, Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#3 0x00007fda444b6298 in JVM_MonitorWait () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#4 0x00007fda4015bd98 in ?? ()</div><div class="line">#5 0x00007fda3c0768d8 in ?? ()</div><div class="line">#6 0x00007fd900000000 in ?? ()</div><div class="line">#7 0x00007fda3c076000 in ?? ()</div><div class="line">#8 0x00007fd9ec28e5d8 in ?? ()</div><div class="line">#9 0x0000000605202798 in ?? ()</div><div class="line">#10 0x00007fd9ec28e648 in ?? ()</div><div class="line">#11 0x00000006052a9e68 in ?? ()</div><div class="line">#12 0x0000000000000000 in ?? ()</div><div class="line">											Thread 8 (Thread 0x7fda32e07700 (LWP 26971)):</div><div class="line">#0 0x00007fda4546b68c in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda44652543 in os::PlatformEvent::park() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#2 0x00007fda44646ddd in ObjectMonitor::wait(long, bool, Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#3 0x00007fda444b6298 in JVM_MonitorWait () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#4 0x00007fda4015bd98 in ?? ()</div><div class="line">#5 0x00007fda3c078a08 in ?? ()</div><div class="line">#6 0x00007fda00000000 in ?? ()</div><div class="line">#7 0x00007fda3c078000 in ?? ()</div><div class="line">#8 0x00007fda32e065e8 in ?? ()</div><div class="line">#9 0x0000000000000000 in ?? ()</div><div class="line">												Thread 7 (Thread 0x7fda32d06700 (LWP 26972)):</div><div class="line">#0 0x00007fda4546da00 in sem_wait () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda446578ea in check_pending_signals(bool) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#2 0x00007fda44650b35 in signal_thread_entry(JavaThread*, Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#3 0x00007fda447930ff in JavaThread::thread_main_inner() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#4 0x00007fda44793205 in JavaThread::run() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#5 0x00007fda44658ca8 in java_start(Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#6 0x00007fda45467aa1 in start_thread () from /lib64/libpthread.so.0</div><div class="line">#7 0x00007fda44d99aad in clone () from /lib64/libc.so.6</div><div class="line">													Thread 6 (Thread 0x7fda32c05700 (LWP 26973)):</div><div class="line">#0 0x00007fda4546b68c in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda44652543 in os::PlatformEvent::park() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#2 0x00007fda4461987f in Monitor::IWait(Thread*, long) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#3 0x00007fda4461a086 in Monitor::wait(bool, long, bool) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#4 0x00007fda44282648 in CompileQueue::get() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#5 0x00007fda4428674a in CompileBroker::compiler_thread_loop() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#6 0x00007fda447930ff in JavaThread::thread_main_inner() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#7 0x00007fda44793205 in JavaThread::run() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#8 0x00007fda44658ca8 in java_start(Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#9 0x00007fda45467aa1 in start_thread () from /lib64/libpthread.so.0</div><div class="line">#10 0x00007fda44d99aad in clone () from /lib64/libc.so.6</div><div class="line">														Thread 5 (Thread 0x7fda32b04700 (LWP 26974)):</div><div class="line">#0 0x00007fda4546b68c in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda44652543 in os::PlatformEvent::park() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#2 0x00007fda4461987f in Monitor::IWait(Thread*, long) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#3 0x00007fda4461a086 in Monitor::wait(bool, long, bool) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#4 0x00007fda44282648 in CompileQueue::get() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#5 0x00007fda4428674a in CompileBroker::compiler_thread_loop() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#6 0x00007fda447930ff in JavaThread::thread_main_inner() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#7 0x00007fda44793205 in JavaThread::run() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#8 0x00007fda44658ca8 in java_start(Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#9 0x00007fda45467aa1 in start_thread () from /lib64/libpthread.so.0</div><div class="line">#10 0x00007fda44d99aad in clone () from /lib64/libc.so.6</div><div class="line">															Thread 4 (Thread 0x7fda32a03700 (LWP 26975)):</div><div class="line">#0 0x00007fda4546b68c in pthread_cond_wait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda44652543 in os::PlatformEvent::park() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#2 0x00007fda4461987f in Monitor::IWait(Thread*, long) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#3 0x00007fda4461a00e in Monitor::wait(bool, long, bool) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#4 0x00007fda446e95a8 in ServiceThread::service_thread_entry(JavaThread*, Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#5 0x00007fda447930ff in JavaThread::thread_main_inner() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#6 0x00007fda44793205 in JavaThread::run() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#7 0x00007fda44658ca8 in java_start(Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#8 0x00007fda45467aa1 in start_thread () from /lib64/libpthread.so.0</div><div class="line">#9 0x00007fda44d99aad in clone () from /lib64/libc.so.6</div><div class="line">																Thread 3 (Thread 0x7fda32902700 (LWP 26976)):</div><div class="line">#0 0x00007fda4546ba5e in pthread_cond_timedwait@@GLIBC_2.3.2 () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda44657c0f in os::PlatformEvent::park(long) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#2 0x00007fda44619b2e in Monitor::IWait(Thread*, long) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#3 0x00007fda4461a00e in Monitor::wait(bool, long, bool) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#4 0x00007fda4478f121 in WatcherThread::sleep() const () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#5 0x00007fda4478f63e in WatcherThread::run() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#6 0x00007fda44658ca8 in java_start(Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#7 0x00007fda45467aa1 in start_thread () from /lib64/libpthread.so.0</div><div class="line">#8 0x00007fda44d99aad in clone () from /lib64/libc.so.6</div><div class="line">																	Thread 2 (Thread 0x7fda32801700 (LWP 27027)):</div><div class="line">#0 0x00007fda4546eb2d in accept () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda44136af1 in LinuxAttachListener::dequeue() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#2 0x00007fda44136c8b in AttachListener::dequeue() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#3 0x00007fda441357da in attach_listener_thread_entry(JavaThread*, Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#4 0x00007fda447930ff in JavaThread::thread_main_inner() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#5 0x00007fda44793205 in JavaThread::run() () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#6 0x00007fda44658ca8 in java_start(Thread*) () from /usr/local/jdk1.7.0_76/jre/lib/amd64/server/libjvm.so</div><div class="line">#7 0x00007fda45467aa1 in start_thread () from /lib64/libpthread.so.0</div><div class="line">#8 0x00007fda44d99aad in clone () from /lib64/libc.so.6</div><div class="line">																		Thread 1 (Thread 0x7fda4588d700 (LWP 26959)):</div><div class="line">#0 0x00007fda454682fd in pthread_join () from /lib64/libpthread.so.0</div><div class="line">#1 0x00007fda45256505 in ContinueInNewThread0 () from /usr/local/jdk1.7.0_76/bin/../lib/amd64/jli/libjli.so</div><div class="line">#2 0x00007fda4524b58a in ContinueInNewThread () from /usr/local/jdk1.7.0_76/bin/../lib/amd64/jli/libjli.so</div><div class="line">#3 0x00007fda4524e0e0 in JLI_Launch () from /usr/local/jdk1.7.0_76/bin/../lib/amd64/jli/libjli.so</div><div class="line">#4 0x0000000000400686 in main ()</div></pre></td></tr></table></figure>
<p>线程状态中的 runnable 从虚拟机的角度来看，表示这个线程正在运行。但是出于 runnable 的线程不一定真正消耗 CPU。出于 runnable 的线程只能说明该线程没有阻塞在 java 的 wait 或者 sleep 方法上，同时也没有等待在锁上面。但是如果该线程调用了本地方法（比如 java.net.SocketInputStream.socketRead0) ，而本地方法出于等待状态，这个时候虚拟机是不知道本地代码中发生了什么，此时尽管当前线程实际上也是阻塞状态，但实际上显示出来的还是 runnable 状态，这种情况下是不消耗 CPU 的。如下线程堆栈所示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&quot;Thread-243&quot; prio=1 tid=0xa58f2048 nid=0x7ac2 runnable [0xaeedb000..0xaeedc480]</div><div class="line">        at java.net.SocketInputStream.socketRead0(Native Method)</div><div class="line">	        at java.net.SocketInputStream.read(SocketInputStream.java:129)</div><div class="line">	        at oracle.net.ns.Packet.receive(Unknown Source)</div><div class="line">	        at oracle.net.ns.DataPacket.receive(Unknown Source)</div><div class="line">	        at oracle.net.ns.NetInputStream.getNextPacket(Unknown Source)</div><div class="line">	        at oracle.net.ns.NetInputStream.read(Unknown Source)</div><div class="line">	        at oracle.jdbc.driver.T4CMAREngine.getNBytes(T4CMAREngine.java:1520)</div><div class="line">	        at oracle.jdbc.driver.T4CMAREngine.unmarshalNBytes()</div><div class="line">	        at oracle.jdbc.driver.T4CLongRawAccessor.readStreamFromWire()</div><div class="line">	        at oracle.jdbc.driver.T4CLongRawAccessor.readStream()</div><div class="line">	        at oracle.jdbc.driver.T4CInputStream.getBytes(T4CInputStream.java:70)</div><div class="line">	        - locked &lt;0x934f4258&gt; (a oracle.jdbc.driver.T4CInputStream)</div><div class="line">	        - locked &lt;0x6b0dd600&gt; (a oracle.jdbc.driver.T4CConnection)</div><div class="line">	        at oracle.jdbc.driver.OracleInputStream.needBytes()</div><div class="line">	        ... ...</div><div class="line">			        at org.hibernate.loader.Loader.list(Loader.java:1577)</div><div class="line">	        at org.hibernate.loader.hql.QueryLoader.list()</div><div class="line">	        at com.wes.timer.TimerTaskImpl.execute(TimerTaskImpl.java:627)</div><div class="line">	        - locked &lt;0x80df8ce8&gt; (a com.wes.timer.TimerTaskImpl)</div><div class="line">	        at com.wes.threadpool.RunnableWrapper.run(RunnableWrapper.java:209)</div><div class="line">	        at com.wes.threadpool.PooledExecutorEx$Worker.run()</div><div class="line">	        at java.lang.Thread.run(Thread.java:595)</div></pre></td></tr></table></figure>
<p>那么 “.<clinit>“ 和 “.<init>“ 各表示什么含义呢？ “.<clinit>“ 表示当前正在执行类的初始化，”.<init>“ 正在执行对象的构造函数。</init></clinit></init></clinit></p>
<p>除接口外，初始化一个类之前必须保证其直接父类已被初始化，并且该初始化过程是由 JVM 保证线程安全的。并非所有的类都拥有一个 <clinit> 方法，在以下条件中该类不会拥有 <clinit> 方法</clinit></clinit></p>
<ul>
<li>该类既没有声明任何类变量，也没有静态初始化语句</li>
<li>该类声明了类变量，但没有明确使用类变量初始化语句或静态初始化语句初始化</li>
<li>该类仅包含静态 final 变量的类变量初始化语句，并且类变量初始化语句是编译时常量表达式</li>
</ul>
<h1 id="2-锁的解读"><a href="#2-锁的解读" class="headerlink" title="2 锁的解读"></a>2 锁的解读</h1><p>多线程中，wait() 和 sleep() 的区别。wait() 和 sleep() 有一个共同点，就是二者都会把当前的线程阻塞住，我们称之为睡眠或者等待。但二者实际上是完全不同的两个函数，有着本质的区别：</p>
<ul>
<li>当线程执行到 wait() 方法上，当前线程会释放监视锁，此时其他线程可以占有该锁，一旦 wait() 方法执行完成，当前线程又继续持有该锁，直到执行完该锁的作用域。<br>wait() 方法退出的原因：<ul>
<li>达到了等待时间，自动退出。如 wati(5000), 5秒后 wait 方法退出</li>
<li>其他的线程调用了该锁的 notify() 方法。当如果多个线程在等待同一个锁，只有一个线程会被通知到</li>
</ul>
</li>
<li>sleep() 与锁操作无关，如果该方法恰好在一个锁的保护范围之内，当前线程及时在执行 sleep() 的时候，仍然继续保持监视锁。该方法实际上仅仅完成等待或者睡眠的语义</li>
</ul>
<img src="/2018/01/06/线程堆栈分析/wait_sleep.png" alt="wait_sleep.png" title="">
<p>与锁相关的三个重要信息如下：</p>
<ul>
<li>当一个线程占有一个锁的时候，线程堆栈中会打印 – locked <0x22bffb60></0x22bffb60></li>
<li>当一个线程正在等待其他线程释放该锁，线程堆栈中会打印 – waiting to lock <0x22bffb60></0x22bffb60></li>
<li>当一个线程占有一个锁，但有执行到该锁的 wait() 上，线程堆栈中首先打印 locked, 然后又会打印 – waiting on <0x22c03c60></0x22c03c60></li>
</ul>
<h1 id="3-线程状态的解读"><a href="#3-线程状态的解读" class="headerlink" title="3 线程状态的解读"></a>3 线程状态的解读</h1><h2 id="3-1-RUNNABLE"><a href="#3-1-RUNNABLE" class="headerlink" title="3.1 RUNNABLE"></a>3.1 RUNNABLE</h2><p>RUNNABLE 从虚拟机的角度看，线程处于正在运行的状态，正在运行不一定消耗 CPU，比如下面的线程栈，在等待 IO</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Thread-39&quot; daemon prio=1 tid=0x08646590 nid=0x666d runnable [5beb7000..5beb88b8]</div><div class="line">  java.lang.Thread.State: RUNNABLE</div><div class="line">      at java.net.SocketInputStream.socketRead0(Native Method)</div><div class="line">	    at java.net.SocketInputStream.read(SocketInputStream.java:129)</div><div class="line">	    at java.io.BufferedInputStream.fill(BufferedInputStream.java:183)</div><div class="line">	    at java.io.BufferedInputStream.read(BufferedInputStream.java:201)</div><div class="line">	    - locked &lt;0x47bfb940&gt; (a java.io.BufferedInputStream)</div><div class="line">	    at org.postgresql.PG_Stream.ReceiveChar(PG_Stream.java:141)</div><div class="line">	    at org.postgresql.core.QueryExecutor.execute(QueryExecutor.java:68)</div><div class="line">	    - locked &lt;0x47bfb758&gt; (a org.postgresql.PG_Stream)</div><div class="line">	    at org.postgresql.Connection.ExecSQL(Connection.java:398)</div></pre></td></tr></table></figure>
<p>下面的线程栈则消耗 CPU</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&quot;Thread-444&quot; prio=1 tid=0xa4853568 nid=0x7ade runnable [0xafcf7000..0xafcf8680]</div><div class="line">  java.lang.Thread.State: RUNNABLE</div><div class="line">      //实实在在对应 CPU 指令</div><div class="line">     at org.apache.commons.collections.ReferenceMap.getEntry(Unknown Source)</div><div class="line">	   at org.apache.commons.collections.ReferenceMap.get(Unknown Source)</div><div class="line">	   at org.hibernate.util.SoftLimitMRUCache.get(SoftLimitMRUCache.java:51)</div><div class="line">	   at org.hibernate.engine.query.QueryPlanCache.getNativeSQLQueryPlan()</div><div class="line">	   at org.hibernate.impl.AbstractSessionImpl.getNativeSQLQueryPlan()</div><div class="line">	   at org.hibernate.impl.AbstractSessionImpl.list()</div><div class="line">	   at org.hibernate.impl.SQLQueryImpl.list(SQLQueryImpl.java:164)</div><div class="line">	   at com.mogoko.struts.logic.user.LeaveMesManager.getCommentByShopId()</div><div class="line">	   at com.mogoko.struts.action.shop.ShopIndexBaseInfoAction.execute()</div><div class="line">	   ......</div></pre></td></tr></table></figure>
<p>下面的代码正在进行 JNI 本地方法调用，具体是否消耗 CPU，要看 TcpRecvExt 的实现，如果 TcpRecvExt 是纯运算代码，那么实实在在的消耗 CPU，如果 TcpRecvExt() 中存在挂起的代码，那么该线程尽管显示 RUNNABLE，实际也不消耗 CPU 的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&quot;ClientReceiveThread&quot; daemon prio=1 tid=0x99dbacf8 nid=0x7988 runnable [...]</div><div class="line">  java.lang.Thread.State: RUNNABLE</div><div class="line">      at com.pangu.network.icdcomm.htcpapijni.TcpRecvExt(Native Method)</div><div class="line">	    at com.pangu.network.icdcomm.IcdComm.receive(IcdComm.java:60)</div><div class="line">	    at com.msp.client.MspFactory$ClientReceiveThread.task(MspFactory.java:333)</div><div class="line">	    at com.msp.system.TaskThread.run(TaskThread.java:94)</div></pre></td></tr></table></figure>
<h2 id="3-2-TIMED-WAITING-on-object-monitor"><a href="#3-2-TIMED-WAITING-on-object-monitor" class="headerlink" title="3.2 TIMED_WAITING(on object monitor)"></a>3.2 TIMED_WAITING(on object monitor)</h2><p>TIMED_WAITING(on object monitor) 表示当前线程被挂起一段时间，说明该线程正在执行 object.wait(int time) 方法，不消耗 CPU</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&quot;JMX server&quot; daemon prio=6 tid=0x0ad2c800 nid=0xdec in Object.wait() [...]</div><div class="line">  java.lang.Thread.State: TIMED_WAITING (on  object  monitor)</div><div class="line">	   at java.lang.Object.wait(Native Method)</div><div class="line">	   - waiting on &lt;0x03129da0&gt; (a [I)</div><div class="line">	   at com.sun.jmx.remote.internal.ServerComm$Timeout.run(ServerComm.java:150)</div><div class="line">	   - locked &lt;0x03129da0&gt; (a [I)</div><div class="line">	   at java.lang.Thread.run(Thread.java:620)</div></pre></td></tr></table></figure>
<h2 id="3-3-TIME-WAITING-sleeping"><a href="#3-3-TIME-WAITING-sleeping" class="headerlink" title="3.3 TIME_WAITING(sleeping)"></a>3.3 TIME_WAITING(sleeping)</h2><p>TIME_WAITING(sleeping) 表示当前线程被挂起一段时间，正在执行 Thread.sleep(int time) 方法，不消耗 CPU</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&quot;Comm thread&quot; daemon prio=10 tid=0x00002aaad4107400 nid=0x649f waiting on condition</div><div class="line">    [0x000000004133b000..0x000000004133ba00]</div><div class="line">	        java.lang.Thread.State: TIMED_WAITING (sleeping)</div><div class="line">	            at java.lang.Thread.sleep(Native Method)</div><div class="line">	            at org.apache.hadoop.mapred.Task$1.run(Task.java:282)</div><div class="line">	            at java.lang.Thread.run(Thread.java:619)</div></pre></td></tr></table></figure>
<h2 id="3-4-TIME-WAITING-parking"><a href="#3-4-TIME-WAITING-parking" class="headerlink" title="3.4 TIME_WAITING(parking)"></a>3.4 TIME_WAITING(parking)</h2><p>TIME_WAITING(parking) 表示线程被挂起，正在执行 Thread.sleep(int time) 方法，不消耗 CPU</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&quot;RMI TCP&quot; daemon prio=6 tid=0x0ae3b800 nid=0x958 waiting on condition [0x17eff000..0x17effa94]</div><div class="line">    java.lang.Thread.State: TIMED_WAITING (parking)</div><div class="line">	       at sun.misc.Unsafe.park(Native Method)</div><div class="line">	       - parking to wait for  &lt;0x02f49f58&gt; (a java.util.concurrent.SynchronousQueue$TransferStack)</div><div class="line">	       at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:179)</div><div class="line">	       at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:424)</div><div class="line">	       at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:323)</div><div class="line">	       at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:871)</div><div class="line">	       at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:495)</div><div class="line">	       at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:693)</div><div class="line">	       at java.lang.Thread.run(Thread.java:620)</div></pre></td></tr></table></figure>
<p>3.5 WAITING(on object monitor)<br>WAITING(on object monitor) 表示当前线程被挂起，正在执行 obj.wait() 只能通过 notify() 唤醒，不消耗 CPU</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&quot;IPC Client&quot; daemon prio=10 tid=0x00002aaad4129800 nid=0x649d in Object.wait() [0x039000..0x039d00]</div><div class="line">       java.lang.Thread.State: WAITING (on object monitor)</div><div class="line">	            at java.lang.Object.wait(Native Method)</div><div class="line">	            - waiting on &lt;0x00002aaab3acad18&gt;; (aorg.apache.hadoop.ipc.Client$Connection)</div><div class="line">	            at java.lang.Object.wait(Object.java:485)</div><div class="line">	            at org.apache.hadoop.ipc.Client$Connection.waitForWork(Client.java:234)</div><div class="line">	            - locked &lt;0x00002aaab3acad18&gt; (aorg.apache.hadoop.ipc.Client$Connection)</div><div class="line">	            at org.apache.hadoop.ipc.Client$Connection.run(Client.java:273)</div></pre></td></tr></table></figure>
<h2 id="3-6-小结"><a href="#3-6-小结" class="headerlink" title="3.6 小结"></a>3.6 小结</h2><p>处于 TIME_WAITING、WAITING 状态的线程不消耗 CPU，处于 RUNNABLE 状态的线程要结合线程代码性质判断，是否消耗 CPU</p>
<ul>
<li>如果是纯 Java 运算代码，消耗 CPU</li>
<li>如果是网络 IO，很少消耗 CPU</li>
<li>如果是本地代码，结合本地代码性质进行判断（通过 pstack/gstack 获取本地线程栈），如果是纯运算代码，消耗 CPU，如果被挂起，不消耗 CPU，如果是 IO，则不怎么消耗 CPU</li>
</ul>
<h1 id="4-接触线程堆栈进行问题分析"><a href="#4-接触线程堆栈进行问题分析" class="headerlink" title="4 接触线程堆栈进行问题分析"></a>4 接触线程堆栈进行问题分析</h1><p>线程堆栈翻译系统当前时间正在执行什么代码。根据这些信息就可以知道系统当前到底在做什么。看堆栈一般从三个视角来分析：堆栈的局部信息、一次堆栈的统计信息（全局信息）、多个堆栈的对比信息</p>
<ol>
<li>视角一  从一次的堆栈信息中，我们能直接获取以下直接的信息：<br> a. 当前每一个线程的调用层次关系（调用上下文），即每个线程当前正在调用哪些函数<br> b. 当前每个线程当前的状态：持有了哪些锁？在等待哪些锁？</li>
<li>视角二  从一次的堆栈信息中，我们还可以获取下面的统计方面信息：<br> a. 当前锁的争用情况：<pre><code>i. 是不是很多线程在等待同一个锁，如果很多线程等待同一个锁，说明这个系统已经出现了性能瓶颈，并导致了锁竞争。还可能是某个线程长时间持有一个锁不释放（比如这个线程正陷入了死循环的代码或者正在请求一个资源，很长时间得不到唤醒）
ii. 是否有死锁，哪些线程形成了死锁
</code></pre> b. 当前大多数线程在干什么，即正在执行什么代码<br> c. 当前线程总数量</li>
<li>视角三 从多次（即前后打印多次堆栈进行对比）的堆栈信息中，我们还可以获得下面的统计对比方面的信息：<br> a. 一个线程是否在长期执行。如果每次打印的堆栈，某一个线程一直处于同样的调用上下文中，那么说明这个线程一直在执行这段代码，此时就要根据代码逻辑检查，这种长期执行是否合理？<br> b. 某个线程是否存在长期获取不到锁的情况？线程是不是永远得不到唤醒？如果每次打印的堆栈，某一个线程一直在等待一个锁，那么就需要检查占有这个锁的线程为什么不释放锁？</li>
</ol>
<p>通过多个视角进行观察，线程堆栈在定位如下类型的问题上非常有帮助：</p>
<ul>
<li>线程死锁分析（视角一）</li>
<li>Java 代码导致的 CPU 过高分析（视角三）</li>
<li>死循环分析（视角三）</li>
<li>资源不足分析（视角二）</li>
<li>性能瓶颈分析（视角二和视角三）</li>
</ul>
<h2 id="4-1-线程死锁分析"><a href="#4-1-线程死锁分析" class="headerlink" title="4.1 线程死锁分析"></a>4.1 线程死锁分析</h2><p>死锁的原因：当两个或多个线程正在等待被对方占有的锁，死锁就会发生。死锁会导致两个线程无法继续运行，被永远挂起。下图中在时间点0，线程 0 占有了 lock0，线程1占有了 lock1，然后时间点 2 线程0 企图获取 lock 1，线程 1 企图获取 lock 0.由于这两个线程互相要等待被对方占有的锁，自己才能继续，因此造成死锁，二者永远没有机会继续运行下去。</p>
<img src="/2018/01/06/线程堆栈分析/dead_lock.png" alt="dead_lock.png" title="">
<p>一个简单的例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">package MyPackage;</div><div class="line">public class Main &#123;</div><div class="line">	public static void main(String[] args) &#123;</div><div class="line">		Object lockobj1 = new Object();</div><div class="line">		Object lockobj2 = new Object();</div><div class="line">		TestThread1 thread1 = new TestThread1(lockobj1,lockobj2);</div><div class="line">		thread1.start();</div><div class="line">		TestThread2 thread2 = new TestThread2(lockobj1,lockobj2);</div><div class="line">		thread2.start();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">                 </div><div class="line">package MyPackage;</div><div class="line">public class TestThread1  extends Thread&#123;</div><div class="line">	Object lock1 = null;</div><div class="line">	Object lock2 = null;</div><div class="line">	public TestThread1(Object lock1_,Object lock2_)</div><div class="line">	&#123;</div><div class="line">		lock1 = lock1_;</div><div class="line">		lock2 = lock2_;</div><div class="line">		this.setName(this.getClass().getName());</div><div class="line">	&#125;</div><div class="line">	public void run()</div><div class="line">	&#123;</div><div class="line">		fun();</div><div class="line">	&#125;</div><div class="line">	public void fun()&#123;</div><div class="line">		synchronized(lock1)&#123;</div><div class="line">			try&#123;</div><div class="line">				Thread.sleep(2);</div><div class="line">			&#125;</div><div class="line">			catch(Exception e)&#123;</div><div class="line">				e.printStackTrace();</div><div class="line">			&#125;</div><div class="line">			synchronized(lock2)&#123;</div><div class="line">			&#125;</div><div class="line">   		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">                 </div><div class="line">package MyPackage;</div><div class="line">public class TestThread2  extends Thread&#123;</div><div class="line">	Object lock1 = null;</div><div class="line">	Object lock2 = null;</div><div class="line">	public TestThread2(Object lock1_,Object lock2_)</div><div class="line">	&#123;</div><div class="line">		lock1 = lock1_;</div><div class="line">		lock2 = lock2_;</div><div class="line">		this.setName(this.getClass().getName());</div><div class="line">	&#125;</div><div class="line">	public void run()</div><div class="line">	&#123;</div><div class="line">		fun();</div><div class="line">	&#125;</div><div class="line">	public void fun()&#123;</div><div class="line">		synchronized(lock2)&#123;</div><div class="line">			try&#123;</div><div class="line">				Thread.sleep(2);</div><div class="line">			&#125;</div><div class="line">			catch(Exception e)&#123;</div><div class="line">				e.printStackTrace();</div><div class="line">			&#125;</div><div class="line">			synchronized(lock1)&#123;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>jstack 得到结果如下（截取后的堆栈信息）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">Found one Java-level deadlock:</div><div class="line">=============================</div><div class="line">&quot;MyPackage.TestThread2&quot;:</div><div class="line">  waiting to lock monitor 0x00007fa1b00062c8 (object 0x0000000758c4aa78, a java.lang.Object),</div><div class="line">  which is held by &quot;MyPackage.TestThread1&quot;</div><div class="line">&quot;MyPackage.TestThread1&quot;:</div><div class="line">  waiting to lock monitor 0x00007fa1b0004ed8 (object 0x0000000758c4aa88, a java.lang.Object),</div><div class="line">  which is held by &quot;MyPackage.TestThread2&quot;</div><div class="line">		 </div><div class="line">Java stack information for the threads listed above:</div><div class="line">===================================================</div><div class="line">&quot;MyPackage.TestThread2&quot;:</div><div class="line">  at MyPackage.TestThread2.fun(TestThread2.java:24)</div><div class="line">	- waiting to lock &lt;0x0000000758c4aa78&gt; (a java.lang.Object)</div><div class="line">	- locked &lt;0x0000000758c4aa88&gt; (a java.lang.Object)</div><div class="line">	at MyPackage.TestThread2.run(TestThread2.java:13)</div><div class="line">&quot;MyPackage.TestThread1&quot;:</div><div class="line">   at MyPackage.TestThread1.fun(TestThread1.java:24)</div><div class="line">	- waiting to lock &lt;0x0000000758c4aa88&gt; (a java.lang.Object)</div><div class="line">	- locked &lt;0x0000000758c4aa78&gt; (a java.lang.Object)</div><div class="line">   at MyPackage.TestThread1.run(TestThread1.java:13)</div><div class="line">	 </div><div class="line">Found 1 deadlock.</div></pre></td></tr></table></figure>
<p>要避免死锁的问题，唯一的办法就是修改代码。一个可靠的并发系统可以说是设计出来的，而不是通过改 Bug 改出来的，这一点与其他类型的 Bug 有很大的不同。另外，死锁的两个或多个线程是不消耗 CPU 的，有的人认为 CPU 100% 的使用率是线程死锁造成的，这个说法是不对的。无限循环（死循环），并且循环中代码都是 CPU 密集型，才有可能导致 CPU 的 100% 使用率，像 socket 或者数据库等 IO 操作是不怎么消耗 CPU 的。</p>
<h2 id="4-2-Java-代码死循环等导致的-CPU-过高分析"><a href="#4-2-Java-代码死循环等导致的-CPU-过高分析" class="headerlink" title="4.2 Java 代码死循环等导致的 CPU 过高分析"></a>4.2 Java 代码死循环等导致的 CPU 过高分析</h2><p>当系统负载大的时候，CPU 的使用率会较高，但是不正确的代码也会导致 CPU 过高，比如死循环。当发生 CPU 过高的问题，我们需要能够分析 CPU 高的真正原因。通过多次打印堆栈，前后堆栈对比找到一直在运行的线程，这些线程都是可疑的线程，具体的步骤如下：</p>
<ul>
<li>通过 jstack 等获取第一次的堆栈信息</li>
<li>等待一段时间，再获取第二次堆栈信息</li>
<li>预处理两次堆栈信息，首先去掉处于 sleeping 或者 waiting 状态的线程，因为这种线程是不消耗 CPU 的</li>
<li>比较第一次堆栈和第二次堆栈预处理后的线程，找出这段时间一直活跃的线程，如果两次堆栈中同一个线程处于同样的调用上下文，那么就应该列为重点怀疑对象。结合代码进行检查</li>
</ul>
<p>如果通过堆栈定位，没有发现热点代码段，那么 CPU 过高可能是不恰当的内存设置导致的频繁 GC，而从导致 CPU 过高</p>
<p>第一次 jstack 的输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&quot;Thread-444&quot; prio=1 tid=0xa4853568 nid=0x7ade runnable [0xafcf7000..0xafcf8680]</div><div class="line">        at org.apache.commons.collections.ReferenceMap.getEntry(Unknown Source)</div><div class="line">	        at org.apache.commons.collections.ReferenceMap.get(Unknown Source)</div><div class="line">	        at org.hibernate.util.SoftLimitMRUCache.get(SoftLimitMRUCache.java:51)</div><div class="line">	        at org.hibernate.engine.query.QueryPlanCache.getNativeSQLQueryPlan()</div><div class="line">	        at org.hibernate.impl.AbstractSessionImpl.getNativeSQLQueryPlan()</div><div class="line">	        at org.hibernate.impl.AbstractSessionImpl.list()</div><div class="line">	        at org.hibernate.impl.SQLQueryImpl.list(SQLQueryImpl.java:164)</div><div class="line">	        at com.mogoko.struts.logic.user.LeaveMesManager.getCommentByShopId()</div><div class="line">	        at com.mogoko.struts.action.shop.ShopIndexBaseInfoAction.execute()</div><div class="line">	        ......</div></pre></td></tr></table></figure>
<p>第二次 jstack 的输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&quot;Thread-444&quot; prio=1 tid=0xa4853568 nid=0x7ade runnable [0xafcf7000..0xafcf8680]</div><div class="line">        at org.apache.commons.collections.ReferenceMap.getEntry(Unknown Source)</div><div class="line">	        at org.apache.commons.collections.ReferenceMap.get(Unknown Source)</div><div class="line">	        at org.hibernate.util.SoftLimitMRUCache.get(SoftLimitMRUCache.java:51)</div><div class="line">	        at org.hibernate.engine.query.QueryPlanCache.getNativeSQLQueryPlan()</div><div class="line">	        at org.hibernate.impl.AbstractSessionImpl.getNativeSQLQueryPlan()</div><div class="line">	        at org.hibernate.impl.AbstractSessionImpl.list()</div><div class="line">	        at org.hibernate.impl.SQLQueryImpl.list(SQLQueryImpl.java:164)</div><div class="line">	        at com.mogoko.struts.logic.user.LeaveMesManager.getCommentByShopId()</div><div class="line">	        at com.mogoko.struts.action.shop.ShopIndexBaseInfoAction.execute()</div><div class="line">	        ... ...</div></pre></td></tr></table></figure>
<p>在长达 5 分钟的时间里，一直在执行 org.apache.commons.collections.ReferenceMap.getEntry() 方法，说明这个方法一直没有结束。具体属于正常还是 Bug，需要结合源码进行判断。</p>
<p>导致死循环的代码属于代码的 Bug，这种类型的问题，重现比较难，但一旦重现，就比较容易解决。一般通过分析代码可以发现问题。导致死循环的原因大致有如下几个：</p>
<ul>
<li>HashMap 等线程不安全的容器，用在多线程读/写的场合，导致 HashMap 的方法调用形成死循环（可以参考2015-08-19 Hadoop升级过程出现异常问题casestudy）</li>
<li>多线程场合，对共享变量没有进行保护，导致数据混乱，从而使循环退出条件永远不满足，导致死循环的发生，比如：<ul>
<li>for, while 循环中的退出条件永远不满足导致的死循环</li>
<li>链表等数据结构首尾相连，导致遍历永远无法停止</li>
</ul>
</li>
<li>其他编码错误</li>
</ul>
<h2 id="4-3-高消耗-CPU-代码的常用分析方法"><a href="#4-3-高消耗-CPU-代码的常用分析方法" class="headerlink" title="4.3 高消耗 CPU 代码的常用分析方法"></a>4.3 高消耗 CPU 代码的常用分析方法</h2><p>借助操作系统提供的性能分析工具进行 CPU 消耗分析。上面介绍了针对死循环导致 CPU 遍告的分析方法，但是有些场景没有死循环也会导致 CPU 变高，我们需要借助系统提供的一些性能分析工具进行分析。在 Linux 中使用 top -p $pid 进行，步骤如下</p>
<ol>
<li>top -p $pid</li>
<li>输入 “H” 查看该进程所有线程的统计情况（CPU 等）如下所示（对于某些操作系统版本不支持 top 命令进行线程统计的</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">下面 PID 表示线程 ID，即 LWPID</div><div class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND</div><div class="line">  25059 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:00.00 java</div><div class="line">  25060 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:00.04 java</div><div class="line">  25061 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:00.00 java</div><div class="line">  25062 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:00.00 java</div><div class="line">  25063 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:00.00 java</div><div class="line">  25064 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:00.00 java</div><div class="line">  25065 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:00.00 java</div><div class="line">  25066 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:00.00 java</div><div class="line">  25067 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:00.00 java</div><div class="line">  25068 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:00.00 java</div><div class="line">  25069 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:01.19 java</div><div class="line">  25070 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:00.00 java</div><div class="line">  25071 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:00.00 java</div><div class="line">  25072 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:00.00 java</div><div class="line">  25073 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:00.00 java</div><div class="line">  25074 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:00.00 java</div><div class="line">  25075 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:00.00 java</div><div class="line">  25076 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:24.31 java</div><div class="line">  25077 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:01.00 java</div><div class="line">  25078 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:01.05 java</div><div class="line">  25141 sankuai   20   0 9918m  55m 8264 S  0.0  0.2   0:00.00 java</div></pre></td></tr></table></figure>
<p>具体导致问题的代码可能是：</p>
<ol>
<li>纯 Java 代码导致的 CPU 过高</li>
<li>Java 代码中调用的 JNI 代码导致的 CPU 过高</li>
<li>虚拟机自身的代码导致的 CPU 过高，比如 GC 的 bug 等</li>
</ol>
<p>可以如下进行分析：</p>
<ol>
<li>top -p $pid 获取最消耗 CPU 的本地线程 ID</li>
<li>jstack 打印出 Java 堆栈</li>
<li>pstack 打印本地线程堆栈</li>
<li>在 Java 线程堆栈中查找 nid=&lt;第一步中最消耗 CPU 时间的线程 id&gt;<br> a. 如果找到的线程是纯 Java 代码，则该 Java 代码导致 CPU 过高<br> b. 如果找到的是 Native code，说明导致 CPU 过高的问题在 JNI 调用中<br> c. 如果找不到对于的线程，则有如下两种可能：<pre><code>i. JNI 调用中重新创建的线程来执行，在 Java 线程堆栈中不存在该线程的信息
ii. 虚拟机自身的代码导致的 CPU 过高，如堆内存不够导致的频繁 fullgc，或虚拟机的 bug 等
</code></pre></li>
</ol>
<h2 id="4-4-资源不足等导致的性能下降分析"><a href="#4-4-资源不足等导致的性能下降分析" class="headerlink" title="4.4 资源不足等导致的性能下降分析"></a>4.4 资源不足等导致的性能下降分析</h2><p>大多数时候资源不足和性能瓶颈是统一类问题。</p>
<ul>
<li>大量的线程停在同样的调用上下文上</li>
<li>资源数量配置太少，系统当前压力比较大，资源不足导致某些线程不能及时获得资源而等待</li>
<li>获得资源的线程把持资源时间太久（比如获取数据库连接），导致资源不足</li>
<li>设计不合理导致资源占用时间过久，如 SQL 语句设计不恰当，或者没有索引导致的数据库访问太慢等</li>
<li>资源用完后，某些异常情况下，没有关闭或回收，导致可用资源泄漏或减少</li>
</ul>
<h2 id="4-5-线程不退出导致的系统挂死分析"><a href="#4-5-线程不退出导致的系统挂死分析" class="headerlink" title="4.5 线程不退出导致的系统挂死分析"></a>4.5 线程不退出导致的系统挂死分析</h2><p>线程挂死，表现为每次打印线程堆栈，该线程都在同一个调用上下文，该类问题可以通过多次打印堆栈进行分析，导致线程挂死的原因有很多，如：</p>
<ul>
<li>线程正在执行死循环代码</li>
<li>资源不足或资源泄漏，造成当前线程阻塞在锁对象上，长期得不到唤醒</li>
<li>如果当前程序和外部通信，当外部程序挂起无返回时，也会导致当前线程挂起</li>
</ul>
<h2 id="4-6-其他问题分析"><a href="#4-6-其他问题分析" class="headerlink" title="4.6 其他问题分析"></a>4.6 其他问题分析</h2><ul>
<li>多个锁导致的锁链分析 – 多个线程等待同一个锁</li>
<li>进行性能瓶颈分析</li>
</ul>
<h2 id="4-7-线程堆栈不能分析什么问题"><a href="#4-7-线程堆栈不能分析什么问题" class="headerlink" title="4.7 线程堆栈不能分析什么问题"></a>4.7 线程堆栈不能分析什么问题</h2><p>线程堆栈定位问题，只能定位在当前线程上留下痕迹的问题，如线程死锁，线程挂死等，另外，定位由于锁的设计不恰当导致的性能问题，线程堆栈也是最有效的工具，因为性能问题时时刻刻反映在当前的线程统计状况上。但线程堆栈对于不留痕迹的问题，就无能为力了。例如：</p>
<ul>
<li>线程为什么跑飞</li>
<li>并发的 Bug 导致的数据混乱</li>
<li>数据库梭镖的问题</li>
<li>在实际的系统中，系统的问题分为几种类型：</li>
</ul>
<p>堆栈中能够表现出问题的，使用线程堆栈进行定位</p>
<ul>
<li>无法在线程中留下痕迹的问题定位，需要依赖一个好的日志设计</li>
<li>非常隐蔽的问题，只能依赖于丰富的代码经验，如多线程导致的数据混乱以及幽灵代码等</li>
</ul>
<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>《Java 问题定位技术》</p>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">
<ul class="pagination">
	 
				
    	<li class="prev"><a href="/2018/02/28/通过-Java-线程堆栈进行性能瓶颈分析/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
  		

        <li><a href="/archives"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/2017/12/22/millwheel/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

    </center>
	</div>

    <!-- share -->
    
        
    <div class="bdsharebuttonbox">
        <a href="#" class="bds_more" data-cmd="more"></a>
        <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
        <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
        <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
        <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
        <a href="#" class="bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a>
        <a href="#" class="bds_evernotecn" data-cmd="evernotecn" title="分享到印象笔记"></a>
        <a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记"></a>
        <a href="#" class="bds_copy" data-cmd="copy" title="分享到复制网址"></a>
    </div>
    <script>
        window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{}};
        with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
    </script>


        

    
    
	
		<!-- donate -->
	
	
	<!-- css -->
  <style type="text/css">
      .center {
          text-align: center;
      }
      .hidden {
          display: none;
      }
    .donate_bar a.btn_donate{
      display: inline-block;
      width: 82px;
      height: 82px;
      background: url("https://c1.staticflickr.com/5/4165/34650023915_0a51fa7b03.jpg") no-repeat;
      _background: url("https://c1.staticflickr.com/5/4165/34650023915_0a51fa7b03.jpg") no-repeat;

      <!-- http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif
           因为本 hexo 生成的博客所用的 theme 的 a:hover 带动画效果，
         为了在让赞赏按钮显示效果正常 而 添加了以下几行 css，
         嵌入其它博客时不一定要它们。 -->
      -webkit-transition: background 0s;
      -moz-transition: background 0s;
      -o-transition: background 0s;
      -ms-transition: background 0s;
      transition: background 0s;
      <!-- /让赞赏按钮的效果显示正常 而 添加的几行 css 到此结束 -->
    }

    .donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
    .donate_bar .donate_txt {
      display: block;
      color: #9d9d9d;
      font: 14px/2 "Microsoft Yahei";
    }
    .bold{ font-weight: bold; }
  </style>
  <!-- /css -->

    <!-- Donate Module -->
    <div id="donate_module">

  <!-- btn_donate & tips -->
  <div id="donate_board" class="donate_bar center">
  
    <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 赞赏"></a>
    <span class="donate_txt">
      Enjoy it ? Donate me ! 欣赏此文？支持一下呗
    </span>
      
    
  </div>
  <!-- /btn_donate & tips -->

  <!-- donate guide -->
    
  <div id="donate_guide" class="donate_bar center hidden">
	<div class="row center">
    <a href="https://c1.staticflickr.com/5/4223/34996145761_303b9fd14d_h.jpg" title="用微信扫一扫哦~" class="fancybox">
      <img src="https://c1.staticflickr.com/5/4223/34996145761_303b9fd14d_h.jpg" title="微信赞赏 klion26" height="164px" width="164px" style="display:inherit;"/>
    </a>
        &nbsp;
    <a href="https://c1.staticflickr.com/5/4272/34962434512_71429ff937_b.jpg" title="用支付宝扫一扫即可~" class="fancybox">
      <img src="https://c1.staticflickr.com/5/4272/34962434512_71429ff937_b.jpg" title="支付宝赞赏 klion26" height="164px" width="164px" style="display:inherit;"/>
    </a>
	</div>
	
    <span class="donate_txt">
      Use App <span class="bold"><a href="http://global.alipay.com/ospay/home.htm">Alipay</a> / <a href="http://www.wechat.com/en/">WeChat</a></span>
			to scan QRCode~ Thx for your support.<br/>
			用手机 <span class="bold"><a href="https://mobile.alipay.com/index.htm">支付宝钱包</a> / <a href="http://weixin.qq.com/">微信</a></span>，
			扫一扫即可~ 谢谢您的鼓励。<br/>
    </span>

  </div>
  <!-- /donate guide -->
  
    <!-- donate script -->
  <script type="text/javascript">
    document.getElementById('btn_donate').onclick = function() {
      $('#donate_board').addClass('hidden');
      $('#donate_guide').removeClass('hidden');
    }

    function donate_on_web(){
      $('#donate').submit();
        }

    var original_window_onload = window.onload;
        window.onload = function () {
            if (original_window_onload) {
                original_window_onload();
            }
            //document.getElementById('donate_board_wdg').className = 'hidden';
    }
  </script>
  <!-- /donate script -->
</div>
<!-- /Donate Module -->
   
  


			
	<!-- comment -->
	
<section id="comment">
  <h2 class="title">Comments</h2>

  
</section>

	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2018-01-06 
	</div>
	

	<!-- categories -->
    

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/Java/">Java<span>3</span></a></li> <li><a href="/tags/线程堆栈/">线程堆栈<span>2</span></a></li> <li><a href="/tags/JVM/">JVM<span>1</span></a></li> <li><a href="/tags/分析/">分析<span>1</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2018 klion26
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
